한 차례 끝난 것 같음

부하테스트, 모니터링 안되는 부분 고칠 예정

서버 배포는?
AWS 예정

래플 고칠 예정

시연?

---
mememe
멀티 쿠폰 사용은 보류

쿠폰 레디스 캐싱 끝남

프론트에서 생성 시 예약 넣어주기 고민 중
> 일단 추라이 할까?
> 코드 겹치는 것만 주의.
> 둘 다 관리자 페이지 사용하니까 페이지를 새로 파는 게 충돌이 안 날 것임.

한 번 이슈 뽑아보기

---

큰일이다!
예약 걸어놓고 예약 시간 수정할 때를 상정 안 했다.
아니 애초에 예약 걸면 시간은 어떻게 조회하지?

쿠폰도 사용이 안되고 있다고 하신다.
플라이웨이 사용하면서 뭐가 안됬나봄.


로그인
회원가입 시 무한 로그인 문제
> 부가 문제 : 리프레시 토큰 무한 새로고침
> 해결하신 듯?


# 이슈 : 일부 도메인 flyway 사용 시 DB 오류

필드 이름이 카멜 케이스인데, 이것이 jpa와 충돌해 사용할 수 없는 문제이다.

```
...
Caused by: org.postgresql.util.PSQLException: ERROR: relation "coupon" does not exist
...
```

테이블의 이름이 Coupon이기 때문이다.
이 때문에 테이블과 필드 모두를 스네이크 케이스로 바꾸어주었다.

그러나 이슈는 여전히 존재했는데, 테이블 진입 후 필드명이 존재하지 않는다고 출력한다.
```
Caused by: org.postgresql.util.PSQLException: ERROR: column c1_0.expiredate does not exist
  Hint: Perhaps you meant to reference the column "c1_0.expire_date".
  Position: 45
```
필드 이름이 불일치하는 것이다.
전체 테이블을 삭제 후 ddl-auto 전략을 validate로 바꾸자 해결되었다.

원인?
expireDate를 예시로 들어보겠다.

flyway DB에 카멜케이스로 등록하고, 엔티티와 비교하는 과정을 거치지 않기 때문에 DB 측은 expire_date로 등록되나, jpa에서는 미검증 상태로 expireDate를 expiredate로 변경하여 바로 찾기 때문에 이런 문제가 발생하는 것으로 추정된다.

한 마디로 jpa의 ddl-auto를 이용해 엔티티와 테이블 간의 비교를 실행하면서 해줘야 한다는 것이다. 1차적으로 카멜케이스 사용, 2차적으로는 ddl-auto none 사용이 원인이었다.


docker compose에서 볼륨 초기화 후 실행하니 꼬여있어서 제대로 실행되던 것들이 이제는 다시 작동을 안하기 시작했다.

그래서 필드 이름 컨벤션 하나로 통일하게 싹 다 수정해주고, 직접 키잡고 있던 것들을 JPA에게 넘겨주었다. 알고보니 네이밍 전략(물리) 쪽을 우리가 잡고 있었다.

카프카도 안되길래 원인을 알아보니 카프카 리스너 팩토리를 커스텀해주면 이걸 꼭 해줘야 한다더라. 근데 왜 나는 안해줘도 됐었지? 신기한 일이다. 볼륨 삭제하면서 제대로 고쳐졌나보다.

그래서 해보니 쿠폰 생성 예약 기능 이제 작동한다.

발표자료에 템플릿 추가함.
피드백 받은 거 기반 페이지 추가
ERD 확인해보니 내가 만질 건 아닌듯함.
테이블이 많아서 한 장에 담아내기 쉽지 않아보인다.


# 그래서 이제 뭐함?

이제부터는 발견되는 문제 픽스만
발표 자료 내용 준비
필요할 것으로 보이는 템플릿 준비
> 플로우 차트는 만드는 것 vs ai 시키는 것?
> 내 껀 똥멍청이라 안되고, 한 명 것으로 디자인을 통일시켜야 할 것으로 보임.

트러블 슈팅 문서들 함 정리해볼 듯.

서비스 시나리오 준비? -> 플로우 설명할 때 좋을듯
기술 관련해서는 본인이 준비하는 게 낫겠져?
요구사항 적용한 것들을 설명해야 하나? 강조할 만한 것들을 2분 이내로 작성할 수 있어야 할 듯.

## 나중에 할 프로젝트 개선 방안

1. 카프카 이용하는 기능들 (쿠폰, 추첨) 스위칭 수정/조회/삭제
	1. Redis로 개선
2. Request-Date 기반 우선순위 부여
	1. 프론트 하나 더 만들어야 됨.
	2. SSE 연결로 내 앞에 접속자 어디까지 있는지
3. 부하테스트 기능 살펴보기

1차때는 스웨거, 워크플로, 시퀀스 다이어그램 사용함.
-> 프론트 화면 메뉴트리 구조도 형식으로 장바구니 메뉴 보여주는 거...
설명하는 것이 그게 더 좋을듯?

민성님
모니터링/로깅 남아있는데 자꾸 문제 되는 중. 구현하던 것까지만 하고 롤백 예정
모니터링만 푸시
성능테스트 조금 남아서 마무리 지을 듯.

놓치고 있던 게 있었다?
쇼핑몰 사진이 안 나오는 중
S3 이용해서 넣는다... 라고 이야기를 했었는데, 어떻게 할 지?

S3가 될까?
안되면 로컬에서 하는 것으로 하기
그 다음 발표자료로 넘어가기