
준영님
민성님 api가 잘 된다?
dev 기준으로 했다.

준영님과 민성님의 코드가 섞임
민성님의 코드가 꼬인 상황
내부적으로 사용하던 기능이 없던 경우도 있어서, 준영님이 해결해야 할 듯

카프카 쪽이 문제가 생길 것 같아 겹쳐잇는 부분을 준영님의 것으로 통합

민성님의 도메인레벨 코드는 없애기
코드베이스 정리 진행


준영님의 구현체가 6개 정도 되는데, 어떤 것을 이용해서 product/cart fetching을 해야 하는지?


모델과 엔티티가 기존에는 동일했다.

근데 모델과 실제로 저장되는 엔티티는 분리되어야 한다?

그런데 왜 이렇게 분리하는 것인지?
vo 없애는 방향으로?


준영님의 경우 민성님의 코드를 사용하고있는 것.
끌어다 쓰면서 전체 코드는 변한게 없다.
vo가 사용은 되는데 검증이 되는지?

DB에 작업해야 할 때는 어떤 거 사용해야 하는지?
interface의 프로덕트 안에 persistance 안에 구현해서 사용하면됨.
리스트 조회? 스프링 데이터 product repository 안에 리스트로 반환하는 인터페이스 메서드가 있다.
-> 이건 왜 분리?
-> 구현체에서 스프링 데이터 리포지토리를 쓰는 거고, 인터페이스임.

DDD 구조를 따라가다 점점 방법 안에서 복잡하게 만들고있다.
민성님, 민규님 / 준원님, 준영님 이렇게 나뉘어지고 있다.

스키마 잡을 때 이것을 좀 잡아줬어야 했을 것 같음.

persistence -> 도메인으로 위치 변경
이것의 목적이 도메인 관심사와 DB 관심사를 분리


민성님, 민규님 방식
리포지토리 인터페이스를 다이렉트로 사용하는 방식, 직접 구현.

준원님, 준영님 방식
인터페이스를 구현하는 방식
persistence 만들고, 리포지토리 구현하고.. 복잡한 구현.

준원님
엔티티를 그대로 넣으면 될 것 같단 생각

도메인 이동, 직접 구현으로 변경


---

2시 업데이트

준원님
민성님이 요청한 것 수정 완
상품이랑 장바구니 진행중

준영님
ERD 수정중
dev 에 아직 안올렸찌만 구현 완료


DDD 발행


----

멘토 피드백

프로덕트 문서 공유

질문같은 거 적어놓은 것 있는지?

질문?
DDD 기반 프로젝트를 구성하는 법을 잘 모르겟움...

버그?
버그 리포트만 하는 것인지? 아니면 팀원간에 의견 교환하고 리팩토링이나 기능 개선 같은걸 할 때도 리포트를 작성해야 하나?

1차때 어디까지 해야 할 지가 고민임. 1차 때 토대를 세우고 2차 전에 피드백을 받아서 디버깅, 리팩토링을 진행하는 것인지?

부하테스트를 하려면 예상 사용자 정하는 게 중요한데, 예상 사용자라던지 정하는 기준은 기존 서비스에서 참고를 하게 되나?


피드백!
전체적으로 경험이 있으신듯함.
잘 만드신듯.
전체적인 아키텍처를 듣고 묻고싶은게 있긴 하지만... 물어볼만한 내용은 아니었다!
구현 궁금한 부분 좀 있다.
레디스 개선 방향? 페이지네이션 어떻게 했는지?
비 로그인 시에도 장바구니 담기가 되는지...

DDD기반 잘 만들었다!
앱 인프라 스트럭쳐에서 도메인 객체 만들어 꺼내와서 쓰시는 형식으로 이해하면 될 것 같죠?


질문
> 기능 구현하는 것이 많이 바빠서 질문할 게 없을 수 있다.

오늘 주제가 버깅과 디버깅이긴 한데, 주제에 대한 질문을 드려보고 피드백 드려보겟슴

디버깅을 할 때 트레이스를 남기거나 로그하거나 디버깅 툴을 쓰거나...
로그만 남기는 것정도 해도 충분할 듯.

원론적인 부분에 대해 설명하자면, 우리가 작성한 코드는 결국 가설이라고 생각된다.
이걸 제대로 작동하는지 검증하는 방법 중 하나가 테스트?
여기서 의도치 않은 결과가 나오면 버그, 버그 찾으면 디버깅

aws, azure 등에 올리게 되면 바로 로그도 못보고 breakpoint 도 못잡으니 cloakwatch 등으로 보내서 클라우드 서버를 디버깅 할 수 있다.

로그는 어떻게 남기고 계시는지?

> 로그 기능은 따로 구현하진 않았고 exception 써주긴 했다.

access log? exception log를 알아보는 것이 좋을 듯 함.
언제, 누가, 어떤 환경에서, 어떤 요청을 보냈는지 url, 헤더, request body 정도 남기고 처리하는 데에 몇 초 걸렸는지, status code 등을 남겨두면 좋을 것 같다.
어플리케이션 상태 보기
access log의 기초적 개념은 가볍게 기록 찍는 정도인데, 그것만으로는 부족하다고 생각함. me는 요청에 대한 정보, 끝날 때 한번 더 찍는 것을 선호함.
시작과 끝을 연결할 수 있는 trace id를 추가해서 시작과 끝, 안에서 발생한 로그들을 볼 수 있다.
당장 다음주에 클라우드 배포를 생각하고 있는데, 이것이 도움이 될 것임.

> 그럼 백엔드 단에서 생기는 액세스 로그 메트릭을 서버 안쪽에 두는 것이 좋은지?
> nginx 프록시를 붙였다. 외부에 로깅 서비스를 넣는 것이 좋은가?

nginx 용도가?

> 현재는 단순히 프록시 서버

단순하게 로드밸런서와 리버스 프록싱만 하는 것? -> 넹
nginx가 걔만의 로그를 또 만들어주면 좋을 듯.
nginx에서 그 메트릭을 다시 받아서 보내주는 건 헤비해보임.

단순하게 jwt로 로그인해서 요청하면 검증하고 파싱할 수 있는 건 스프링 서버. 꺼내서 로그인하기까지 하려면 스프링에서 못하는 단적인 이유 존재.
어플리케이션 개발하다가 아리까리 한데 싶은 부분(로컬 잘됨 외부 안됨)
외부 요청 api 보내는 것도 요청 로그 남기는 것들이 좋을 것 같다

DB를 제외한, 비동기 처리에 대한 로깅이 워낙 어려우니 그런 것들에 대한 처리를 해주는 것이 좋을 것 같다.

요청에 대한 흐름을 기억하는 객체라고 해주면 좋을 듯.
한 줄로 로그 쭉 세워서 요청 흐름을 볼 수 있다.
클라우드 환경 모니터링이 아주 쾌적해질 것이다.

glk라는 스택?
로그 관련 개발 스택.
클라우드 워치에서 단순하게 볼 수도 있는데 방법론은 많으니 현 단계에서 간단하게 볼 수 있는 것 적용해보세요~

> response 할 때 CUD일 때는 어떤 값을 보내야 하는지 기준이 어떻게 됨?
> 생성되고 끝이다. 201로 끝내는 것인지, 데이터를 넘겨줘야 하는 것인지?

restful에 대한 고민을 하셨을 것 같다. 일반적인 질문이 맞긴 하다!
리소스를 내려주거나 바디를 안주는 경우 둘 다 있지만 정답은 없다고 생각함.

그렇게 중요하진 않다?

-> 필요에 따라 정해두고 원하는 대로 하면 된다라고 이해하면 되는지?

예 맞워요!
Rest api 원칙을 꼭 지켜야 하는 것은 아님.

실제로 restful하기는 쉽지 않다. 그 스펙은 매우 하드함.
FE와 BE의 이해도가 굉장히 높아야되고, 이걸 구현하기에는 어려울 수 있다.

실버불릿은 없다. 그 스펙을 무조건 맞출 필요는 없으니 큰 틀을 맞춰놓아라.

> 스프링과 DDD 방식이 처음이다.
> 엔티티에 VO 까지 적용을 해보았다.
> 느낀 점이 로드가 굉장히 많다고 생각했다.
> VO를 적용하는 것이 좋은 건지 어려운 건지 잘 모르겠다.
> 이런 방식에서는 어떤 걸 선호하는지?

로드가 많다는 것이 어떤 의미? -> 엔티티마다 각 VO 달아주고 검증로직이나 간단한 로직을 구현. 손댈 게 너무 많아진다.

작업 리소스가 많이 드는데, 이게 합리적인가? 라고 이해를 했다.

현업에서도 VO를 적용하는 지 궁금.

DDD 방식에선 VO 써서 얻는 이점이 분명 있기에 사용을 한다.
도메인에 의미있는 값들을 보통 넣어두게 되는데, 보통 validation 용도로 많이 쓰게 되는 것 같음.
엔티티마다 vo가 있어야 되냐는 질문에는 NO라고 생각함

필요한 경우에만 사용하면 될듯.

우리는 도메인 무결성을 지키기 위해서 쓰고 있다. 혹시 어떻게 쓰는지?
-> 검증이 주된 목적
중요한 값들에 대한 Validation은 장점이 확실히 있었다.
그런데 끌어다 써야 한다? 이 경우 추가로 알아야 하는 학습 곡선이 발생했다. 무결성을 지킬 수 있고, 개발하는 경험에서는 좋은 경험이 아니었던 것 같음.

방금 말씀하신 부분에서 다른 도메인 영역을 사용해야 할 때 뜯어봐야 하는 수고가 있다. 이 뜻은 코드가 빡빡하다는 것이다.
validation이 잘 되어있어 뚫릴 여지가 적다.
데이터가 오염되지 않는다.

민성님이 장단점을 잘 느꼈을 것!

VO를 만들어두면 실수가 날 일이 적다.
그걸 노리는 것이라고 생각함.
그런 의도라면 무조건 쓰는 것이 좋을 것 같다. 팀 전체로 확장하는 것이 좋을 듯.

> 값에 대한 검증이 중요한 포인트니까 금융쪽에서 사용하면 좋은 기능인것인지?

VO는 필수이다.
금융, 결제는 VO 뿐만 아니라 많은 validation이 들어가야 한다.

전체적인 부분에서 들어가면 좋을 것 같다.

우리만의 DB 룰을 만들었다면 그걸 앞단에서 검증, 도메인 레이어에서도 방어막이 하나 더 있는 것임.
커스텀한 타입을 지정하지 않으면 못잡는다.
도메인 룰을 적용할 수 있는 꽤 좋은 방식이 VO

> 담당한 게 쇼핑몰에서 재고가 부족해지면 알림이 오는 로직이다.
> 방법으로 sse, socket 방식이 있었다.
> (로직 설명)
> 로직이 for 루프로 되어있다.
> 실시간이라 건 by 건으로 주다 보니 중간에 2명 주다 끊기면 롤백 해야하는데 나머지 사용자는 안주는 문제 발생할 수 있을 것 같음.
> 이런 로직 경험 구성이 있다면 조언을 듣고 싶다.

생각난 문제 발생 가능 지점은 다른 것이긴 한데 일단 ㅇㅋ
이걸 5명의 유저에 대해 스레드 여러 개 만들어서 병렬 처리하면 안되는지?
-> 실시간성 담당하셨거나 그렇다면 이런 걸 조언을 듣고 싶었어용

일단 for문의 오버헤드는 쿼리가 다섯 개 나간다.
송신은 일단 생각하지 않고, DB만 생각하자.

하나의 쿼리로 가져오는 것이 좋을 것 같다.
보내는 것도 병렬로 보내는 것이 좋을 듯.
한 방의 쿼리로 다 꺼내서 한 번에 병렬?
보내는 것만 for문으로 보내면 상관이 없을 듯.


kafka 썼다고 했는데 어떻게 되어있는지?
누가 sender고 누가 receiver?
일단 단일 서버. 보내는 서버, 받는 서버가 따로 있는 게 아니잖아요?
큐에다 넣고 같은 서버가 받아서 처리한다. 워커가 따로 있는 게 아니다. 라고 판단했는데, 이때 학습 측면에서는 너무 좋지만, 왜 썼는지에 대해서는 고민을 좀 더 해주는 것이 좋을 것 같다.

sse가 서버가 클라우드에서 인스턴스 1개만 쓸 수 있지만 여러개를 쓸 수도 있다.
도커 컨테이너 여러개 떠있으면 하나의 EC2에 여러가면 상관 없다.
근데 다른 것들도 long-polling으로 물려있을 것.
다른 서버로 sse로 보내라라는 명령을 떨구면 웹소켓이든 실시간 통신에 대해 세션 관리 고민이 있는 부분.
물리적으로 다른 서버에 커넥션이 물려있어서 다른 서버에서는 못보냄.
그 과정에서 동기화하기 위한 목적으로 카프카 쓰면 더 장점이 될 듯함.
이 부분에 대해서는 충분히 고민해볼 것.
본인은 레디스 커넥션만 연결해주면 알아서 세션 공유 해주는 기능이 있긴 했었지만, 여러 해결방법 찾아볼 것.


본인 궁금점 있음.
이벤트 기반 아키텍처라 해주셨던 것 같은데 맞는지?
-> 주문 생성 과정, 결제 이벤트 시 이벤트 드리븐이라 생각함.

결제 요청 왔을 때 파생되는 여러가지 루트들이 있고 연결하는 방식이 코드 상으로 메서드 호출 방식이 아니라 이벤트 날리면 받는 녀석들이 알아서 비동기 처리한다. 이렇게 이해하면 되는지
-> yes!

EDA가 콜백이 제일 어려움.
문제 생겼을 때 처리하는 것이 어려운데 어떻게 되어있는지?
-> 사실 그부분까지 생각은 못해봤어염 ㅎㅎ

모놀리식에서는 어려운 게 ontholotic에서는 하기 쉬운 게 있을 수 있다?


postgresql 사용중인데 레디스 사용해서 성능 개선 계획?
요청마다 확인해야 하는 DB 쿼리가 있을 것. DB call이 너무 많아서 레디스로 옮기는 경우 존재.
의미있는 경우 아닐 경우 인메모리 처리 많은데, slow query를 개선하는 경우면 어떤 경우일지?
-> 그냥 적용해보고 싶어서 막연하게 해보기만 햇습니당... 레디스로 이벤트 들어오면 처리하는 방식 되지 않을까 생각중.

레디스 pub/sub? 쓰읍... 흠.

장바구니는 로그인 안한 유저도 사용할 수 있는지?
-> 일단 모든 api는 인증 토큰이 필요함.

 UX적 조언을 드리자면, 로그인 안해도 하는 경우가 많다.
 물건 살 때 총 금액이 얼마인지 계산 해보고 싶은 경우가 있고, 로그인 했더니 다 날아가고 다 이럴 수 있다.

페이지네이션 궁금하긴 함.
오프셋 방식인지?
-> 일단 pageable 적용함. 마음에 안드는 부분이 있어서 커서 기반으로 개선 예정

커서 기반이 요즘 좋아서, 1, 2 왔다갔다 하는 거 아니면 이거 제안하려고 했는데 벌써 사용하고 계씨다 하시니 좋겠다.

오늘 못다한 얘기는 2차때 합시다.


---

> DDD 방식 관련 질문
> 서비스가 다른 서비스를 사용해야 하는데, 이때 그러면 단순한 타입이라던지로 주기 어려울 수 있음. dto를 사용해야 하는데, 디렉토리의 위치가 어떻게 되는지?



강사님
주말에 일요일에 리뷰 가능
2차때는 강사님이 오실 수 있으니 준비

멘토님 질문 리스트 업 해둘 것.
질문하면서 의도나 상황은 알겠으나, 5명에게 알림 던졌다가 문제 생겼다고 이걸 롤백할 수준의 문제가 있는 트랜잭션은 아니다.
비즈니스 이해에 대한 것이나 조금 논리적인 대답이 필요하다.

다음 주 월요일 1차 종료, 2차가 따로 시작.
각자의 발표가 따로 있는 것.
ppt에 localHistory에 넣었다가 장바구니 반영하는 것들 등 추가 제안.
기능을 넣을거냐 말거냐는 2차때.
기술 부채는 나중에


---


추첨 시 상품 재고 깎아주는 메서드 있으면 좋을 거 같음.
어플리케이션 해주시면 감사하다

sse를 stock으로 보내는 거 말고 단순 차감이 필요하다에요


2차 종료기간은 19일
클로드? 커서?

목요일 오후까지 ppt 피드백 참석할 사람.
끝날 때 알려주시면 조율하겠다
24시간 상관없음