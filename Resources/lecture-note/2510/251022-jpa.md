jpa again

# 비즈니스 메서드 / 편의 메서드의 이해

1. MyBatis

비즈니스 요구사항에 따라 쿼리가 생기고 FK 조인하고...
jpa 넘어오면서 단순히 어노테이션 붙이는 거 제외, 비즈니스 메서드 만들지 않고 구성해서 괜찮았다.
비즈니스 로직을 사용하게 되면 도메인이 주체인 흐름으로 넘어가게 된다.

2. 도메인 주체 엔티티

단순 getter setter만 사용하지 않고 의미있는 메서드를 사용하는 것이 트렌드이다.

> i.e. decreaseCurrentStudents(), Course.isInstructor(user)와 같은 형태

또한 필드로 객체를 포함하도록 구성을 해준다.

sql anti pattern 같은 책 한번 읽어보면 좋다.
안티 패턴 같이 지양하는 패턴을 공부하면 이해에 도움이 된다. 성능 보다는 비즈니스 메서드, 설계 철학에 관련된 것임.

3. jpa ORM
jpa 어노테이션이 붙는다.
DB 매핑과 도메인 행위를 모두 담당
비즈니스 메서드는 jpa와 무관하게 존재

4. 단방향 / 양방향
4-1. 단방향
한쪽에서만 연관관계를 관리, 동기화 대상 없음.

cud
객체처럼 핸들링하면 부모 객체 저장 시 자식도 갱신이 되야함.
그러나 이런 식으로 작동하지 않는다. 그렇기 때문에 고아 객체가 생기가 되고...
그렇기 때문에 주인 쪽에서 명시적 관계 설정 후 저장해야 한다. (fetchType, cascadeType과 같은? 관계? 설정.)

따라서 부모객체에서만 관리하게 된다.
느슨한 관계

4-2. 양방향
세가지 기능
1. 탐색
양방향 객체 탐색
2. 동기화
상태 불일치 방지
3. Cascade
연관 엔티티 함께 저장 및 삭제

주의 사항?
단방향 탐색 가능, 양방향 + 편의 메서드 없음 = 의미없음.

Aggregate
DDD에서 나온 용어.
여러 엔티티들이 하나의 논리적 단위로 묶인 것
내부 관계의 관리 및 탐색 편의성으로 인해 사용

양방향 관계는 편의 메서드가 필수. 양쪽 객체에서 관리하게 되기 때문에 한쪽을 관리하지 않으면 동기화되지 않아 상태 불일치 발생
강하게 결합된 관계라고 표현됨.

> 편의 메서드
> 양방향 연관관계에서 양쪽 객체를 일관되게 동기화하는 메서드

결론?

비즈니스 메서드 : 도메인 설계 철학에 따라 만들어진 메서드. 도메인 복잡도에 따라 선택적 적용

편의 메서드 : jpa 양방향 관계에서 동기화와 같은 기술적 편의성에 의해 구현함. 양방향 관계에서 필수적.

---

