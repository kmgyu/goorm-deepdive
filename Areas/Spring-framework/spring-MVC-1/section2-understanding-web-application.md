WAS는 HTTP 기반 동작
웹 서버 기능 포함 (정적 리소스 제공 가능)
프로그램 코드를 실행해 앱 로직 수행
- 동적 html, http api(json)
- 서블릿, jsp, 스프링 mvc
i. e. tomcat, jetty, undertow

웹서버는 정적 리소스, WAS는 앱 로직

[[week1_WAS]] 참고하면 된다.
웬만한 내용 다있음...

애플리케이션 로직? 비용이 많이 든다.
비용 발생의 대부분은 트랜잭션에서 일어나는 것으로 알고 있음...
왜 트랜잭션은 비용이 커지는가? 흠...

WAS는 잘 죽는다고 함.
웹서버는 잘 안죽는다.
WAS 죽는 것도 모니터링 붙여서 죽었나 살았나 감시하고 죽으면 개발자한테 슬랙 메시지 보내는 것도 가능하다고 한다... 어떻게 하는건데 

---

서블릿

서버 tcp/ip 대기, 소켓 연결
http 요청 메시지를 파싱하고~
이런 귀찮은 로직 대신해주는 것이 서블릿 코드

Front-Controller라고도 불리는 DispatcherServlet이 뭘 하는 지 알 수 있는 부분?
굉장히... 간단히 요약했다.

http 요청/응답 정보를 편리하게 사용 및 제공
개발자는 http 스펙을 매우 편리하게 사용할 수 있다.

서블릿 컨테이너
- 톰캣처럼 서블릿 지원하는 WAS
  그러면 스프링은 WAS가 두 개인거임???
- 서블릿 컨테이너는 서블릿 객체 생성, 초기화, 호출, 종료하는 생명주기 관리
- 서블릿 객체는 싱글톤으로 관리
	- stateless이므로... 공용 변수 사용 주의
	- 서블릿 컨테이너 종료 시 함께 종료
- JSP도 서블릿으로 변환되어 사용
- 동시 요청 위한 멀티 쓰레드 처리 지원

---

멀티 쓰레드

쓰레드
- 앱 코드를 하나하나 순차적으로 시행
- 쓰레드 없으면 자바 앱 실행 불가능
- 쓰레드는 한번에 하나의 코드 라인만 수행
- 동시 처리 필요 시 쓰레드 추가 생성

요청마다 쓰레드 생성
장점
- 동시 요청 처리
- 리소스 허용할 때까지 처리 가능
- 하나의 쓰레드가 지연되어도, 나머지는 정상 동작
단점
- 쓰레드 생성 비용은 매우 비쌈
	- 고객 요청이 올 때마다 쓰레드 생성시, 응답 속도 지연
- 쓰레드는 컨텍스트 스위칭 비용 발생함
- 쓰레드 생성에 제한이 없다
	- 고객 요청 너무 많이 오면 CPU, 메모리 임계점을 넘어 서버가 죽을 수 있다.

쓰레드 풀
특징
	필요한 쓰레드를 쓰레드 풀에 보관/관리
	생성 가능한 쓰레드 최대치 관리. 톰캣은 최대 200개로 기본 설정

사용
	쓰레드 필요 시, 이미 생성된 쓰레드를 풀에서 꺼내서 사용
	사용 종료 시 반납
	쓰레드가 모두 사용중이라면 요청은 거절하거나 특정 숫자만큼만 대기하도록 설정 가능

장점
	쓰레드 미리 생성되어 있으므로 생성 및 종료 비용(CPU) 절약, 응답 시간 빠름
	생성 가능 쓰레드 최대치 있으므로 너무 많은 요청이 들어와도 기존 요청은 안전하게 처리 가능

실무 팁?
WAS의 주요 튜닝 포인트는 최대 쓰레드 수이다.
너무 낮으면 리소스가 여유롭지만, 응답 시간 지연된다.
동시 요청이 너무 많으면 cpu, 메모리 리소스 임계점 초과로 서버 다운

장애 발생 시?
클라우드 환경이면 서버부터 증설, 이후 튜닝
클라우드 환경 아니면 열심히 튜닝

적정 숫자 찾기
애플리케이션 로직 복잡도, CPU, 메모리, IO 리소스 상황에 따라 모두 다름
성능 테스트
- 최대한 실제 서비스와 유사하게 성능 테스트 시도
- 툴: 아파치 ab, 제이미터, nGrinder

핵심?
멀티 쓰레드는 WAS가 처리
개발자는 관련 코드 신경쓰지 않아도 됨
개발자는 마치 싱글 쓰레드 프로그래밍 하듯이 편리하게 소스 코드를 개발
싱글톤 객체(서블릿, 스프링 빈)는 주의해서 사용

---

html, http api, csr, ssr

html
동적으로 필요한 html 파일 생성해 전달
웹 브라우저는 html 해석

http api?
데이터를 전달
주로 json 형식 사용
다양한 시스템에서 호출

UI 화면이 필요하면, 클라이언트가 별도 처리함.
앱 / 웹 클라이언트 / 서버 to 서버 등

---

SSR
서버가 일해서 렌더링하는 것
html을 만드는 과정을 서버가 다 하는 것이다

CSR
클라이언트가 일해서 렌더링하는 것
html 결과를 js 사용해, 웹 브라우저에서 동적 생성해 적용한다.
필요한 부분만 변경 가능함.
구글 지도, gmail, 구글 캘린더 같은 것.

react, vue.js 등 csr, ssr 동시 지원하는 웹 프레임워크도 있다.

CSR 방식
내용은 비어있고, js 링크를 준다.
js? 클라이언트 로직, html 렌더링 코드가 있다.
이거 기반으로 브라우저가 직접 html 렌더링하도록 시킨다! 와!

---

자바 웹 기술 역사?
다 아는 거구만 허허허

어노테이션 기반 스프링 mvc 등장
mvc 프레임워크 춘추 전국 시대 마무리

스프링 부트 등장
- 과거에는 서버에 was를 직접 설치, 소스는 war 파일 만들어 설치한 was에 배포
- 스프링 부트는 빌드 결과(Jar)에 WAS 서버를 포함. -> 빌드 배포 단순화
해보니까 알겠다... 진짜 말도 안 될 정도로 불편하다..

웹기술 분화
web servlet - spring mvc
web reactive - spring webflux

웹 플럭스?
특징
- 비동기 넌 블러킹 처리
- 최소 쓰레드로 최대 성능 - 쓰레드 컨텍스트 스위칭 비용 효율화
- 함수형 스타일로 개발 - 동시처리 코드 효율화
- 서블릿 기술 사용X
그런데
- 기술적 난이도 매우 높음
- 아직 RDB 지원 부족
- 일반 MVC 쓰레드 모델도 충분히 빠름
- 실무에서 아직 많이 사용하지는 않음
> 강의가 나온지 시간도 좀 됐는데 지금은 어떨까

뷰 템플릿 역사
jsp
속도 느림, 기능 부족

프리마커, 벨로시티
속도 문제 해결, 다양한 기능

타임리프
내추럴 템플릿 : html 모양 유지한다. Jinja도 해당할듯?
스프링 mvc와 강력한 기능 통합
성능은 프리마커, 벨로시티가 더 빠름.

무스타쉬는?? 끄에엑