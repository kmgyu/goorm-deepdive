수호님 발표

웹소켓(stomp)

채팅 시스템 스텀프를 구현해보려고 했다.

채팅하려면 채팅 치고 새로고침하고...
이것은 우리가 아는 채팅 방식이 아니다!

웹 소켓의 통신구조
- 클라이언트 / 서버 간의 실시간 양방향 통신을 가능케 하는 통신 프로토콜
- 클라이언트 -> 서버로의 요청이 아니라, 클라이언트 요청 없이도 서버 - 클라이언트가 가능
- HTTP 통신이 아니기 때문에 http:// 대신 ws://의 url을 가진 웹소켓프로토콜을 사용
    - STOMP 메시지 프레임워크를 사용할때에는 명시적으로 ws:// 프로토콜을 사용하지는 않지만, 내부적으로 ws://프로토콜 사용


HTTP 요청과 웹소켓의 차이?
HTTP는 비 연결형. 한 번 request/response 교환하면 커넥션 끊음
- 네트워크 IO의 오버헤드가 커지는? 성능 저하 발생
웹소켓은 한번 연결 시 계속 연결
인증 처리는 최초 한 번의 연결에 한함



polling 방식과 websocket 방식의 비교
Polling?
- 클라이언트가 서버에 주기적 요청을 보내 업데이트를 확인
- HTTP 요청만 처리하면 되므로 추가 설정이 필요없는 간결함
- 서버 부하가 존재.
Web Socket
- 클라이언트와 서버 간 지속적 연결 유지
- 부하 측면에서 Polling보다 우수

STOMP는 웹 소켓 위에서 동작하는 메시징 프로토콜
웹 소켓 만으로는 메시징을 구현하기 어려움

중간에 브로커라는 것을 위치시켜 각 채팅방(예시.)들을 구독시키는 역할을 해줌.



redis pub/sub
메시지 발행, 구독 절차
독특한 아키텍처
웹 소켓 서버가 여러 개일 때, 특정 topic을 구독하게 된다면 서로 다른 서버에 있는 같은 topic을 구독하는 사람은 서로 같은 정보를 구독할 수 없다.
따라서 Redis를 통해 이런 정보를 공유하는 방식

> Event-driven architecture를 구현하도록 Redis가 제공하는 기능

---

웹 소켓은 사용자와 1:1 매칭이 되는지?
그렇다면 사용자가 늘어날 수록 무한대로 늘어나는지?
하나하나에 대한 객체가 생성이 되나?

채팅에 대한 순서 보장 같은 것은 어떻게 하나?


Long-polling이라는 기능도 있다.
Polling이라는 게 지속적으로 요청을 해줘야 하는데, 이걸 느리게 받는 방법

영상 프로토콜 방식?
UDP. -> HTTP3에 QUIC을 적용한다.

데이터 보내는 방식도 프레임 방식으로 보낸다.
