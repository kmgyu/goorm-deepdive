준영님

스프링 MSA

Kafka 실습을 해보다.

docker-compose

zookeeper랑 kafka 브로커 이미지 써서 해준다. 와우!

zookeeper는 웨 필요함?
kafka는 분산 시스템. 여러 브로커가 클러스터를 이루고 데이터와 메타데이터를 분산 저장함. 클러스터 상태를 관리하고 조율하는 역할이 Zookeeper.

카프카 2.8 이상부터는 K left mode?에서는 주키퍼가 없어도 된다.
근데 레거시에서는 필요하다. 웬만해선 쓰는 편이 좋을 듯.

Kafka의 핵심 역할은 브로커.
컨슈머랑 프로듀서?생산자 이어주는 거

토픽이라는 것으로 잡을 관리한다. 이런 것들 복제 요건도 관리함

리스너 포트 세팅으로 뭐든지 다들어 대나무숲(아님) 포트를 설정해줄 수 있다.

유레카, api게이트웨이, 유저-서비스 서버 실습했던 것을 꺼낸다.
카프카 의존성을 추가한다!

카프카 프로듀서, 컨슈머 생성도 해줘야 한다. 

프로듀서는 보통 이 토픽에 이 메시지 보냄 이런 거 만들어줌.
컨슈머는 특정 토픽을 구독한다. 메시지 받고 처리함

아파치 카프카
분산형 이벤트 스트리밍 플랫폼
대용량 데이터를 빠르고 안정적으로 주고받는 메시지 시스템

브로커 : 메시지 저장, 프로듀서/컨슈머 요청 처리
토픽 : 메시지 구분 단위, 데이터 흐름 이름표
파티션 : 카프카 브로커 내부 토픽을 나눈 조각, 병렬 처리 가능
프로듀서 : 메시지를 토픽에 발행
컨슈머 : 토픽 메시지를 구독하고 처리
컨슈머 그룹 : 여러 컨슈머를 묶어 메시지를 나눠 받게 함.
주키퍼 : 클러스터 관리, 브로커 상태 감시, 리더 선출


이벤트 기반 서비스가 뭔가욤?
MSA는 서비스의 여러가지 기능을 작게 쪼갬. 어... 뭔가 많았는데 정리 실패
카프카는 기능을 시행해서 어떤 변경사항이 생기면 효율적으로 다른 서비스에 알리는 역할.

우리가 만드는 서비스는 rest api인데 하나하나 다 처리해주니 MSA 아님?
일일이 다할지? 카프카를 통해서 다 해줘야 할지?
분산형 시스템의 여러 이점들이 많아 사용한다.

컨슈머와 프로듀서로 해주징
이벤트 기반 / 요청-응답 기반이라는 컨셉이 있다.
rest-api는 프론트(클라이언트)에서 정확한 자원과 주소를 알아야 한다.
그래서 즉각적으로 동작한다.
이벤트 기반은 프로듀서와 컨슈머가 있어서 카프카는 프로듀서가 생성하고 컨슈머는 꺼내간다. 바로바로 동작할 필요가 없음.
이벤트는 일단 카프카 넣어두고 생기면 누가 가져갈 지 모른다.
토픽만 정해두고 누군가 필요한 녀석들이 동작하도록 하는 컨셉

장점은 느슨한 결합.
서비스에 의존성을 가지지 않게됨.
동일한 토픽에서 동일한 동작이 가능함.
우리 자바 아니라 파이썬 서버 할거야 -> 뎃


데이터 보낼 때 한번의 크기는 어떻게 되나?
몰라용

데이터 포맷은 어떻게 되는지?
스트링으로 가는것인가?
tcp/ip 기반임. 이거나 http 같은 것은 바이트코드로 직렬화되서 들어온다.
직렬화랑 역직렬화되서 들어오지 않을까? 라는 질문
포맷은 제대로 지정되어 있지 않지만, json, xml 등 지정 가능하다. 실제로 내부적으로는 바이트 코드로 주고받음.

---

월요일에 3명만 남음
