클린 코드 & 에러 처리

컨벤션
프로젝트에서 사용하는 관례
> 단순히 코드 작성 뿐만 아니라 커밋 메시지나, 이슈 작성 등에서도 광범위하게 쓰이는 것으로 알고 있음...

# 8.1. 코딩 규칙

**들여쓰기**
들여쓰기로 가시성 늘릴 것

**중괄호**
열린 중괄호는 대부분 조건식 바로 뒤, 닫힌 중괄호는 줄바꿈한다.
```
if() {
	examples...
}
```

if ~ else 등에서는 일관성이 중요함.
만약 한 행인경우 중괄호는 안 열어도 되지만, 나중에 수정할 때 수정자가 까먹고 중괄호를 안 만들 수 있다. 넣어주자.

**네이밍 규칙**
프로젝트마다 다르지만 자바는 일반적으로 이렇다.

- 패키지 : 소문자로만
- 클래스 : 파스칼(어퍼카멜)
- 메서드 : 카멜
- 변수 : 카멜

# 8.2. 의도가 분명한 코딩

`/* fall through */`
잘 알려진 오픈소스 같은 곳에서 같은 주석을 볼 수 있다.
코딩의 의도를 분명하게 표현하기 위해 사용됨.

코딩 의도를 분명하게 표현하는 관례를 살펴본다.

**switch-case의 올바른 사용**
```java
switch(fruit) {
	case 'apple': /* fall through */
	case 'banana':
		price = 1000;
		break;
	case 'melon':
	price = 1500;
	default:
	/* some error code */
}
```
이런 식으로 break의 의도적인 생략 시, `/* fall through */`를 추가해야 한다. 다른 개발자들은 이것을 누락되었다고 판단할 수 있기 때문

**괄호**
우선순위를 보다 확실하게 구분하기 위해, 가독성을 위해 사용.
웬만하면 그냥 쓸 것

**switch 문에 반드시 포함되어야 함**
default는 누락되면 안된다.
고객 요구사항이 바뀌거나 다양한 에러가 발생하는 상황을 대비해야 하기 때문

**변수 선언, 초기화는 한 행에 하나**
```java
int result1, result2 = 1;
```
여기서 result2는 1이 할당되고 result1은 할당 안됨. 헷갈리니 하지 말것


언어별로 코딩 스타일이 존재한다.

python : pep8, google python style guide
java : code conventions for the java tm programming language, google java style guide
C/C++ : google C++ style guide
js : google javascript style guide


복잡한 코드는 좋지 않다.
코드 복잡도를 말할 때, 사이크로매틱 복잡도라는 용어를 사용함.
조건문과 반복문의 개수가 많으면 그만큼 복잡하다라고 표현함.
조건문과 반복문의 개수를 결정 포인트라고 함.
계산은 다음과 같다.
사이크로매틱 복잡도(CC) = 결정 포인트 + 1

맥케이브가 제안한 복잡도별 위험도
함수 안에서는 20 이하가 되도록 코딩하라고 권고한다.
1~10 : 낮음
11~20 : 보통
21~50 : 높음
50 초과 : 매우 높음

# 8.3. 시큐어 코딩 규칙

CWE에서 공개한 취약점 제거가 이상적

> CWE?
> 보안 취약점이 생길 수 있는 소프트웨어 결함을 분류하고 관리하기 위해 만든 소프트웨어 보안 약점 분류체계

CWE에서 공개한 약점이 600개가 넘어서 CWE에서는 발생 빈도가 높은 순의 약점 25개를 추려 공개한다.

주로 자바, C/C++을 사용한 웹 기반 시스템 대상으로 제공된다.

CERT secure coding이라는 규칙도 존재.
C/C++, 자바, 안드로이드, 펄 등으로 다양한 코딩 언어의 시큐어 코딩 규칙 지원

# 8.4. 원인 분석을 위한 에러 처리

자바 기준이다.

try~catch 구문에서 finally는 반드시 수행해야 하는 작업 시 작성하는 구간
자원 해제 등이 해당됨

**예외사항 처리 코드 미작성 시**
division zero와 같은 문제 사항 발생 시 최악의 경우 프로그램 중단

**exception throw & catch**
throw된 exception을 제대로 안받으면 jvm이 수습한다. 받아주자.

**각 클래스의 예외 처리**
예외 처리 코드 작성 시 클래스에서 던지는 exception을 파악하는 것이 우선이다
혹시 모르니 해당 exception에 추가로 Exception e를 catch하도록 해주자.

파이썬도 유사하게 Exception class를 사용한다.

**Error vs Exception**
catch할 수 있는 것은 Exception만 해당
Error와 Exception의 계층 구조를 참고하자.

Throwable은 예외 던지기, 에러 로그나 메시지 출력하는 역할

Exception은 예외 클래스 중 최상위
IOException이 대표작 예외

그래서 차이점?
Error는 복구 불가능한 심각한 상황에서 실행됨
스택 오버플로우 같은 것

Exception은 프로그램이 해결 가능한 에러

# 8.5. 부적절한 메시지의 종류

에러 메시지는 사용자에게 중단 지점, 에러 발생 이유 등에 대해 설명한다.
부적절한 에러 메시지, 안티 패턴을 알아본다.

**원인 불명**
`알 수 없는 에러`
무책임한 최악의 메시지.
개발자는 에러 증상을 알 수 없으며 사용자, 개발자 모두 문제 원인을 찾기 어렵다.

`파일을 삭제할 수 없습니다.`
이 에러의 경우, 다수 파일을 삭제할 때 어떤 파일을 삭제하지 못하는 것인지 알 수 없다.

적절한 예
`Cannot Delete file : Access Denied : ~/myfile.ddd`
다음과 같이 원인을 알려주어야 한다.


탓하는 듯한 메시지, 딱딱한 인상을 주는 메시지
`잘못 입력하셨습니다.`
원인을 알려주지 않고, 어투가 적절하지 않다.
`잘못된 형식의 이메일. @ 문자 누락`
이 또한 어투 수정 필요

적절한 예
`이름에 특수문자가 포함되었습니다. 특수문자를 제외하고 다시 입력해주세요.`
`이메일 형식이 다릅니다. @ 문자가 포함되어 있는지 확인해 주세요.`
좀 더 친절해졌다.


개발자만 이해할 수 있는 정보를 사용자에게 노출
```
java.security.NoSuchAlgorithmException: Cannot find any provider supporting AESS/CBC/PKCS5Padding
...
```
에러 메시지가 개발자와 사용자 사이의 간접적인 소통이라는 점에서, 부적절한 메시지이다. 사용자는 알 수 없음.

모든 항목을 사용자에게 알아서 입력하라는 것 또한 부적절하다.
`이메일 또는 전화번호 또는 닉네임이 유효하지 않습니다.`
회원가입하는데 이런 식으로 알아서 잘 입력하라는 형식의 메시지가 뜨면 불쾌할 것임.

UI에서 각 항목 입력란마다 붉은 문구를 추가해서 어떤 것을 잘못 입력했는 지 알려주는 것이 이상적


**보안에 문제가 있는 메시지**
`가입되지 않은 사용자`
`비밀번호가 잘못 됨`
이러한 정보는 해킹 과정에서 유용하게 활용될 수 있음.

따라서 로그인 시 사용하는 메시지는 모호하게 작성하는 것이 좋다.
`아이디 또는 비밀번호가 잘못되었습니다.`

Not Found, Bad Request등 오류 페이지도 해커에게 좋은 정보가 된다.
이런 페이지는 에러 뿐만 아니라 시스템 웹서버, 운영체제 등 다양한 내부 정보를 출력할 수도 있다...
따라서 내부 정보를 노출하지 않는 메시지나 페이지를 제공해야 한다.

SQL 에러 내용을 그대로 에러 메시지로 제공하는 것도 적절하지 않다.
DBMS마다 SQL 쿼리문의 문법이 조금씩 다르기 때문에 해킹 대상 시스템이 사용하는 DBMS를 알지 못할 경우 그 효율은 현저히 떨어진다. 그러나 SQL 에러 메시지를 제공하는 순간 DBMS 유형을 파악할 수 있는 힌트를 주게 되기 때문에, 이런 메시지는 노출하지 않는 것이 좋다.