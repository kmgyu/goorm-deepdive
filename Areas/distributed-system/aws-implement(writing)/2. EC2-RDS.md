
원래 계획에서는 DB를 사용할 인스턴스를 만들어주려고 했으나 rds에서도 프리티어가 가능하기 때문에 관리를 aws에 넘긴 rds를 사용하였다.

세팅 시간도 비슷하다.

생성까지는 쉬운 방법이니 적당한 기반지식이 있다면 다른 자료들을 보거나 없이도 사용할 수 있다.
[추가적인 세팅 참고](https://jih3508.tistory.com/167)

생성 이후 인스턴스에 연결해볼 것이다. (생성 시 인스턴스 연결했다면 상관없다.)

연결된 컴퓨팅 리소스에서 작업을 눌러 EC2 연결 설정에 들어가, 연결되어야 하는 EC2 인스턴스를 설정해주면 된다.
이렇게 해주면 자동으로 인스턴스의 RDS 포트(생성 시 설정 가능)가 인스턴스에 연결된다.

[rds vs ec2](https://junuuu.tistory.com/183)

---

# 마이그레이션

[참고자료](https://mollangpiu.tistory.com/185)

여기서는 mariaDB를 사용했다.
기존 로컬 db에서 마이그레이션을 해줄 것이다. (필요한 경우 사용할 것.)

로컬 마리아 DB에 접속해서 마이그레이션 먼저 해주자.
도커를 사용했기 때문에 exec을 통해 덤프파일을 추출해야한다.

마이그레이션 대상 확인을 위해 바로 db에 진입해준다.
```
docker exec -it mariadb-container mariadb -u root -p
```

대상 확인 후 mariadb-dump를 이용해준다. (mysql은 mysqldump)

```
docker exec [컨테이너 이름] mariadb-dump -u [사용자명] -p[비밀번호] [데이터베이스명] > [파일경로]
```

이제 추출한 파일을 aws로 전송해야 한다.

```bash
scp -i your-key.pem dump.sql ubuntu@<EC2_PUBLIC_IP>:/ur/path
```

다음과 같이 scp 명령어를 이용해 파일을 전송한다.

pem 파일이 권한 문제로 인해 매우 많이 시간을 잡아먹었다...

이렇게 추출한 것은 EC2 인스턴스에 옮겨져 있기 때문에 DB RDS를 접속하여 연결해주어야 한다.

미리 `CREATE DATABASES [db]`를 통해 본인 db를 만들어주면 좋다.

```
mariadb -h [RDS host] -P 3307 -u root -p [db_name] < [backup-file].sql
```
이 명령어를 사용하면 마이그레이션이 완료된다.
데이터가 많은 경우 상당히 오래걸릴 수 있다. 각 행을 insert 문으로 삽입하기 때문에... 이에 대한 해결 방법은...?
#todo 

----
