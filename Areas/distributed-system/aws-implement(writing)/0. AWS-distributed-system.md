> #todo 조사한 자료나 일일 구현 정도를 작성하여 나중에 정리한다.
> 참고자료도 모아놓는 곳
> 종합적으로 문서 둘러보고 갱신 필요하다.
> DB도 RDS로 중간에 바꿔서 인스턴스라고 남겨진 부분 존재할 수 있음!

# 시작하기

이번 구현에 있어서 가장 우선순위가 높은 것은 속도이다.
그렇기 때문에 다소 비용이 발생하더라도 환경 구축에서는 빠르게 속도를 높여 테스트할 수 있는 환경을 만들어 본다.
그래서 자료 조사 및 문서 정리도 나중으로 미뤘다. 핫하



분산 환경에서의 문제점이나 성능 테스트를 실험하려면 클라우드를 이용해야 한다.

AWS, Azure, Vultr 등을 사용할 수 있다.

환경 구축하기 쉬운... AWS를 사용했다.
Azure는 학생 버전이 존재하지만 학습 곡선이 높다. 빠르게 해야 한다.

분산 환경 구축에 앞서, 깃헙에서 직접 소스코드를 풀해와서 빌드하고 관리하는 것은 끔찍한 일이다. Docker를 이용해 이미지화해서 컨테이너로 관리해주도록 하자.

CI/CD 파이프라인을 구축해볼 것이다.
1. Github Actions를 통해 이미지를 빌드하고, Docker hub에 푸시한다.
2. EC2 ssh access
3. 기존 컨테이너 닫고 pull, 도커 이미지 실행
Github Actions를 이용하면 이런 식으로 된다.
근데 분산환경이면 ec2 다해줘야 하지 않나?

---

분산 시스템 구축 자체가 처음이기에 구글링 해가면서 조사했다.

[[aws-summit-2017-aws-ecs]]

https://heekng.tistory.com/242 - aws ecs + fargate 클라우드 배포


aws에 구축하는 클라우드 디자인 패턴 시리즈 1~5부를 참고했다.
[AWS 에 구축하는 클라우드 디자인 패턴 시리즈 1부: 안정성](https://aws.amazon.com/ko/blogs/tech/cloud-design-patterns-on-aws-1/)  
[AWS 에 구축하는 클라우드 디자인 패턴 시리즈 2부: 연결성 및 조합](https://aws.amazon.com/ko/blogs/tech/cloud-design-patterns-on-aws-2/)  
[AWS 에 구축하는 클라우드 디자인 패턴 시리즈 3부: 마이그레이션](https://aws.amazon.com/ko/blogs/tech/cloud-design-patterns-on-aws-3/)  
[AWS 에 구축하는 클라우드 디자인 패턴 시리즈 4부: API 관리](https://aws.amazon.com/ko/blogs/tech/cloud-design-patterns-on-aws-4/)  
[AWS 에 구축하는 클라우드 디자인 패턴 시리즈 5부: 데이터 관리](https://aws.amazon.com/ko/blogs/tech/cloud-design-patterns-on-aws-5/)

초기에는 kafka로 cheorography 패턴을 구성해야 하지 않나 싶었는데 트래픽 분산을 해야하기에 로드 밸런서가 구조에 필요했다.

이 경우 로드밸런서로 nginx 또는 aws alb, k8s 등이 있다.

EC2는 2~3대로 테스트 목적으로만 사용할 것이기에 당연히 빠른 구현이 가능한 nginx를 선택한다.

---

251021 현재 구조는 다음과 같다.

인스턴스
LB (load balancer)
api-1
api-2
monitoring

DB는 제외되었으나, 로컬에서라도 배포해야하나 생각중

CI/CD도 겸해서 해볼것이다.

Jenkins를 사용해야하나 github actions를 사용해야하나 고민중

로드 밸런싱 사용하기 때문에 api 쪽은 8080만 뚫어준다.
나머지는 private ip 사용하기 때문에 아웃바운드 뚫어주지 않는다.
(정확히는 동일한 VPC를 사용하기 때문에 가능하다.)

---

251022
ssh 연결이 안된다
우리 학교 WiFi는 ssh 연결을 막고 있다.
접속할 수 없다. 포기

---

251023
인스턴스가 벌써 비용이 청구되기 시작했다.
최대한 비용을 줄일 방도를 찾아야 한다.
우선 elastic IP는 최대한 적게 쓰기로 했다.
인스턴스만 5대다!

Redis 캐싱에 대해 생각하고 있던 중 Caffeine, EhCache라는 것을 발견했다.
[공식 문서](https://docs.spring.io/spring-boot/reference/io/caching.html#page-title)를 참고하면 9개의 캐시를 볼 수 있다.
기본 캐싱과 Redis 캐싱의 성능 차이라던가 얘네도 Sticky Session 같은 문제가 발생하는 지 궁금하다. 구현 속도는 얼마나 되는가 라던가...
그런 것도 면밀히 비교해보면 좋을 것 같다.
[참고자료](https://blog.yevgnenll.me/posts/spring-boot-with-caffeine-cache)

짜잔. DB에서도 해시 인덱스로 캐싱해줄 수 있다는 사실~
하하 해볼 것이 늘었군.

---






추가 참고 자료 모음
https://ksh-coding.tistory.com/134 - aws ECS
https://kdh0518.tistory.com/25 - docker hub ci/cd
