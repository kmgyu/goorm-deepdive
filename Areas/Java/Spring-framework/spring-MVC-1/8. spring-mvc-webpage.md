spring web
lombok
thymeleaf

실습 플젝은 spring boot 2.4.2 기준으로 되었음!

실습이라 작성할 사항이 많이 없음. 프로젝트 팁들?

요구사항 분석
FE 개발자가 웹 퍼블리싱 하는 경우도 있다.
백엔드 개발자는 http api를 통해 웹 클라이언트가 필요로 하는 데이터와 기능을 제공하면 된다. 뷰 다 만들어주지 않아도 됨

@Data는 위험하다?
getter, setter, @RequiredArgsContructor, @ToString, @EqualsAndHashCode 다 추가해주는데, 예상치 못하게 동작할 수 있음.
알고 있으면 괜찮은 것이 아닌가?

dto는 @Data 써도 괜찮지만 한번 확인하는 것이 좋다.

싱글톤 객체에 필드 만들 경우 thread-safe 하게 만들어야 한다. (병렬 프로그래밍 고려하려면...)
HashMap 대신 ConcurrentHashMap 같은 것들...

test할 때
given, when, then 분리하는 습관을 들이면 좋을 듯.
실습하면서 자꾸 이런 형식으로 코드를 짠다. 이해하기도 쉽고 좋은 코드인듯

정적 파일이 잘 안보일때?
프로젝트 폴더의 out에 정적 파일이 빌드된다.
거기서 css라던가 html 파일을 삭제해주면 빌드할 때 다시 생성됨.

타임리프의 th: 를 붙여주면 타임리프 문법 사용 가능
href='@{/resources/\~\~\~}' 식으로 해주면 타임리프가 중간에 바꿔줌...

참고용 기본 표현식
- 변수 : `${...}` - `${student.id}`
- 선택자 : `*{...}` - `*{id}`
- 메시지 : `#{...}` - `#{id}`
- 링크URL : `@{...}` - `@{https://www.naver.com}`
- 부분적 표현 : `~{...}` -
- 조건 연산자 : `and, or, not, !`
    - `${student.age} > 20 and ${student.age} < 10` 처럼 각각 분리하여서 사용하거나
    - `${student.age > 20 or student.age < 10}` 처럼 한 번에 묶어서 사용하는 것도 가능
- 텍스트 결합 : `${student.id}+${student.name}`
- 문장 결합 : `|학생 아이디 : ${student.id}, 학생 이름 : ${student.name} |` - `|` 로 전체 문장을 묶어줌
- if-then : `if ? then` - `${student.age < 20} ? '청소년'`
- if-then-else : `if ? then : else` - `${student.age < 20} ? '청소년' : '성인'`
- default : `value ?: defaultValue`

> 이외에도 조건 분기, 반복문, th:block? 등을 지원한다.
> th:href 있고 href가 있다? 그럼 내추럴 템플릿, th: 지정안된 태그가 우선적으로 선택된다.


Thymeleaf는 기본적으로 템플릿 엔진이 HTML 태그를 해석하고 변환
그래서 `th:*` 속성과 원래 태그 속성이 같이 있으면, Thymeleaf가 우선해서 처리하고, 원래 속성은 무시되거나 대체됨.
타임리프가 적용되지 않을 때에도 작동하게 하려면 미리 본문에다가 둘 다 입력시켜주면 된다.

타임리프는 순수 html 파일을 웹 브라우저에서 열어도 내용 확인 가능하고, 서버 거치면 뷰 템플릿으로 동적으로 변경된 결과 확인이 가능하다.
jsp는 html jsp 문법 뒤죽박죽이라 jsp로만 열 수 있다!
이렇게 순수 html 유지하며 뷰 템플릿도 사용할 수 있는 것을 내츄럴 템플릿이라고 한다.

리터럴 대체
|welcome to our app. ${user.name}!| 식으로 편리하게 사용 가능

루프문
tr th:each="item : ${items}"
해주게 되면 하위 태그를 포함해서 컬렉션 수만큼 생성됨

th:text
내용 변경

@{..}
경로를 템플릿처럼 편리하게 사용, 경로 변수 및 쿼리 파라미터도 생성 가능

질문-답변에서 얻은 팁
```java
@PostMapping("/add") public String addItemV4(@ModelAttribute("item") Item item, RedirectAttributes redirectAttributes) { Item savedItem = itemRepository.save(item); redirectAttributes.addAttribute("itemId", savedItem.getId()); redirectAttributes.addAttribute("status", false); //?status=true 뜬다 url에 return "redirect:/basic/items/{itemId}"; // 이런식으로 리다이렉트 하는게 더 안전 }
```

```thymeleaf
<h2 th:if="${param.status}" th:text="'저장완료'"></h2>
```
다음과 같은 코드는 무조건 true가 된다?!?!?!
Thymeleaf에서 `th:if` 조건문은 JavaScript와 유사하게 값의 ‘truthy’와 ‘falsy’를 평가
문자열 “false”도 해당 조건에서 truthy로 간주될 수 있다.
그렇다. 우리의 타임리프는 param.status를 문자열로 보내준다!

redirect attribute는 무조건 문자열을 주기 때문. (url이니까...!! 그래서 숫자타입도 파싱 후 형변환 과정을 거침!)

따라서 == "true"로 비교문 써주거나, 리다이렉트된 경로에서 request param으로 잡아주는 방법이 있다.


@ModelAttribute의 숨겨진 기능
@ModelAttribute("item") 이런식으로 해주면?
model.addAttribute("item", item); 이 코드까지 자동으로 추가된다.
model에 자동으로 @ModelAttribute로 등록된 매개변수를 넣어주기 때문에 생략이 가능함. 와!!

"item"과 같이 이름 설정해주지 않으면 camelCase 형식으로 클래스이름을 자동으로 바꿔서 모델 어트리뷰트에 넣어준다.

그리고 model은 생략이 가능하다. 이 경우에도 똑같이 동작한다!
대상 객체는 모델에 자동으로 등록된다.

html form 전송은 put, patch 지원하지 않음. get, post만 사용 가능하다.
put, patch는 http api 전송할 때 사용한다.
히든 필드를 통해 put/patch 매핑을 사용하는 방법이 있긴 하지만 http 요청 상 post 매핑이다.


# PRG
등록하고 페이지에서 새로고침만 하는데 계속 생성이 된다.
상품 등록 폼 post - 상품 상세 호출
우리는 get으로 상품 등록 폼을 요청하고 post로 결과를 보냈다.
응답 데이터를 만들고 끝이 난 상황인데, post를 마지막에 했으므로 새로고침 시 해당 행위가 반복됨.

간단한 해결법
리다이렉트

Post/Redirect/Get이라 해서 PRG라 부른다! 실무에서도 많이 써먹는 방법이라고 함.



RedirectAttributes

`redirect:/basic/items/` + `item.getId()`와 같이 url에 변수를 더해 사용하는 것은 url 인코딩이 안되기 때문에 위험하다고 한다.

```java
@PostMapping("/add") public String addItemV4(@ModelAttribute("item") Item item, RedirectAttributes redirectAttributes) { Item savedItem = itemRepository.save(item); redirectAttributes.addAttribute("itemId", savedItem.getId()); redirectAttributes.addAttribute("status", true);
return "redirect:/basic/items/{itemId}
```
이런식으로 해줌!
